---
title: 'Cell10x Output'
date: "`r Sys.Date()`"
output:
  html_document:
---


```{r include=FALSE}
knitr::opts_chunk$set(prompt=TRUE, comment='', echo=FALSE, collapse=TRUE, message=FALSE, warning=FALSE)
baizer::pkglib(baizer, tidyverse, ggsci, ggbeeswarm, plutor, ComplexHeatmap, 
  plotly, ggplotify, echarts4r, jsonlite, knitr, htmltools)

sample <- snakemake@wildcards[['sample']]

# replace default configs with sample configs
config <- replace_item(snakemake@config, snakemake@config[[sample]])

# all results
Lres <- readRDS(snakemake@input[['visualize_rds']])

# css
css_dir <- snakemake@params[['css_dir']]
css_content <- str_c(css_dir, dir(css_dir), sep='/') %>% 
    map(xfun::read_utf8) %>%
    reduce(~c(.x, .y))
```

```{css, code=css_content, echo=FALSE}
```


```{r}
# metadata
p <- Lres[['metadata']]
if (!is.null(p)) {
  h1('metadata')
  p
}

h1('cells')
Lres[['cells']]

h1('filter')
Lres[[1]][['filter']]
```

```{r}
Vflt_mode <- intersect(names(config[['flt_mode']]), names(Lres))

flt_mode <- Vflt_mode[1]

h1(str_c('filter mode: ', flt_mode))

# mRNA
p <- Lres[[flt_mode]][['mRNA']]
if (!is.null(p)) {
    h2('mRNA')
}
if (!is.null(p)) {
    p
}

# BD

p <- Lres[[flt_mode]][['HT']]
if (!is.null(p)) {
  h2('hashtag')
}
if (!is.null(p)) {
  p
}


p <- Lres[[flt_mode]][['BD']]
if (!is.null(p)) {
  h2('binding feature barcode')
}
if (!is.null(p)) {
  p
}


# VDJB
p1 <- Lres[[flt_mode]][['VDJB']][['table']]
p2 <- Lres[[flt_mode]][['VDJB']][['plot']]
if (!is.null(c(p1, p2))) {
  h2('Bcell VDJ')
}
if (!is.null(c(p1, p2))) {
  p1
}
if (!is.null(c(p1, p2))) {
  p2
}

```